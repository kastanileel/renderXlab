<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>renderXlab</title>
        <link rel="stylesheet" href="style.css">
        <link rel="icon" href="./faviconTest.png" type="image/png">
        <!-- enabling mathjax in html text blocks-->
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

        <!-- mathjs, linear algebra library in use, have a look at utils/RXLMath.js-->
        <script src="https://cdn.jsdelivr.net/npm/mathjs@11/lib/browser/math.js"></script>
    </head>
    <body>
        <h1> This is an example</h1>
        
        <h3> roughness x</h3>
        <input type="range" id="sliderRX" min="0" max="1000" value="500" step="1">
        <h3> roughness y</h3>
        <input type="range" id="sliderRY" min="0" max="1000" value="500" step="1">
 
        <br>
        <h3> metalness</h3>
        <input type="range" id="sliderMetal" min="0" max="1000" value="500" step="1">
        <canvas id="example0" width="800" height="600"></canvas>

        <script type="module">
            // This is just a rough idea of how the framework can be used:

            const canvas = document.getElementById('example0');

            import {RXLContext} from './core/RXLContext.js';
            const rxlContext = await RXLContext.create(canvas);

            // example
            import {Scene} from './render/Scene.js';
            const sceneConfiguration = { 'bvhBuildStrategy' : 'SAH'};
            const scene = await Scene.create('./scenes/cornell.json', sceneConfiguration);

            import {ShaderModule} from './render/components/ShaderModule.js';
            //const shaderModule = await ShaderModule.create(rxlContext, './shaders/example.wgsl');
            const shaderModule = await ShaderModule.create(rxlContext, './shaders/shadertoy.wgsl');
            // would be cool to support other sl than wgsl since this is a quite new language
            //const shaders1 = loadShaders('./shader/example.glsl')
            
            // register an arbitrary number of ui elements 
            import {UIManager} from './render/components/UIManager.js';
            const uiManager = new UIManager();
            uiManager.register(document.getElementById('sliderRX'), 1, (oldValue, e) => parseFloat(e.target.value)/1000);
            uiManager.register(document.getElementById('sliderRY'), 1, (oldValue, e) => parseFloat(e.target.value)/1000);
            uiManager.register(document.getElementById('sliderMetal'), 1, (oldValue, e) => parseFloat(e.target.value)/1000);
            

            // bindgroups are fixed/ derived internally
            import {Pipeline} from './render/components/Pipeline.js';
            const pipeline = await Pipeline.create(rxlContext, shaderModule, scene, uiManager); 
            
            let lastTime = 0;

            function renderLoop(currentTime){

                // convert to seconds
                const deltaTime = (currentTime - lastTime)/ 1000.0;
                lastTime = currentTime;

                // dispatch compute/render pass
                pipeline.dispatch()

                // present image to canvas
                //pipeline.present()

                // update pipeline, react to ui input
                pipeline.update(lastTime, deltaTime);
            
                requestAnimationFrame(renderLoop);

            }

            renderLoop(0);
            
            
        </script>
    </body>
</html>