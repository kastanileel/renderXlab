<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>renderXlab</title>
        <link rel="stylesheet" href="style.css">
        <link rel="icon" href="./faviconTest.png" type="image/png">
        <!-- enabling mathjax in html text blocks-->
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

        <!-- mathjs, linear algebra library in use, have a look at utils/RXLMath.js-->
        <script src="https://cdn.jsdelivr.net/npm/mathjs@11/lib/browser/math.js"></script>
    </head>
    <body>
        <h1> This is an example</h1>
        
        <input type="range" id="slider0" min="0" max="1000" value="500" step="1">
        <canvas id="example0"></canvas>

        <script type="module">
            // This is just a rough idea of how the framework can be used:

            const canvas = document.getElementById('example0');

            // placeholder image for the canvas... will be removed soon
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const ctx = canvas.getContext('2d'); 
            
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, 'lightblue');
            gradient.addColorStop(1, 'navy');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'white';
            ctx.font = '48px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('RenderXLab Placeholder', canvas.width/2, canvas.height/2);

            import {RXLContext} from './core/RXLContext.js';

            const rxlContext = await RXLContext.create(canvas);

            // example
            import {Scene} from './render/Scene.js';
            const sceneConfiguration = { 'bvhBuildStrategy' : 'SAH'};
            const scene = new Scene('./scenes/cornell.json', sceneConfiguration);

            import {ShaderModule} from './render/components/ShaderModule.js';
            const shaderModule = await ShaderModule.create(rxlContext, './shaders/example.wgsl');
            // would be cool to support other sl than wgsl since this is a quite new language
            //const shaders1 = loadShaders('./shader/example.glsl')

            
            // register an arbitrary number of ui elements 
            import {UIManager} from './render/components/UIManager.js';
            const uiManager = new UIManager();

            const slider = document.getElementById('slider0');
            uiManager.register(slider, 1, (oldValue, e) => parseFloat(e.target.value)/1000);
            

            // bindgroups are fixed/ derived internally
            import {Pipeline} from './render/components/Pipeline.js';
            const pipeline = await Pipeline.create(rxlContext, shaderModule, scene, uiManager); 
            
            
            let lastTime = 0;

            function renderLoop(currentTime){

                // convert to seconds
                const deltaTime = (currentTime - lastTime)/ 1000.0;
                lastTime = currentTime;

                // dispatch compute/render pass
                pipeline.dispatch()

                // present image to canvas
                //pipeline.present()

                // update pipeline, react to ui input
                pipeline.update(lastTime, deltaTime);
            
                requestAnimationFrame(renderLoop);

            }

            renderLoop(0);
            
            
        </script>
    </body>
</html>